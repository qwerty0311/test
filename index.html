<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>방탈출 게임: 시스템 복구</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nanum+Gothic+Coding&family=Orbitron:wght@400;700&display=swap');

        body {
            font-family: 'Nanum Gothic Coding', monospace;
            color: #00ff41;
            text-align: center;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #0a0a1a;
            background-size: cover;
            background-position: center;
            transition: background-image 1s;
        }
        body.stage-1 { background-image: url('./1-1.jpg'); }
        body.stage-2 { background-image: url('./2-1.jpg'); }
        body.stage-3 { background-image: url('./3-1.jpg'); }

        .game-container {
            width: 100%;
            max-width: 800px;
            border: 2px solid #00ff41;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px #00ff41;
            background-color: rgba(0, 0, 0, 0.5);
        }

        h1, h2 {
            font-family: 'Orbitron', sans-serif;
            color: #ff00ff;
            text-shadow: 0 0 5px #ff00ff;
        }

        .stage {
            display: none; /* 기본적으로 모든 스테이지 숨김 */
            padding: 20px;
            border-top: 1px dashed #00ff41;
            margin-top: 20px;
        }

        .stage.active {
            display: block; /* 활성화된 스테이지 표시 */
        }

        .puzzle {
            margin-bottom: 30px;
            padding: 15px;
            background-color: #1a1a2a;
            border-left: 5px solid #00ff41;
        }

        .puzzle-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #ffffff;
        }

        .puzzle-content {
            margin: 10px 0;
            color: #a0a0b0;
            line-height: 1.6;
        }

        .code-block {
            background-color: #000;
            color: #fff;
            padding: 10px;
            border-radius: 5px;
            text-align: left;
            white-space: pre-wrap;
            font-family: 'Nanum Gothic Coding', monospace;
        }

        input[type="text"] {
            background-color: #000;
            border: 1px solid #00ff41;
            color: #00ff41;
            padding: 10px;
            width: 60%;
            font-family: 'Nanum Gothic Coding', monospace;
            font-size: 1em;
            margin-top: 10px;
        }

        button {
            background-color: #ff00ff;
            color: #fff;
            border: none;
            padding: 10px 20px;
            font-family: 'Orbitron', sans-serif;
            cursor: pointer;
            border-radius: 5px;
            font-size: 1em;
            margin-left: 10px;
            transition: background-color 0.3s, box-shadow 0.3s;
        }

        button:hover {
            background-color: #c000c0;
            box-shadow: 0 0 10px #ff00ff;
        }

        .message {
            margin-top: 15px;
            font-weight: bold;
            min-height: 20px;
        }

        .success {
            color: #00ff41;
        }

        .error {
            color: #ff0000;
        }

        #clue-box {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ff00ff;
            background-color: #1a1a2a;
            color: #ffffff;
            border-radius: 5px;
        }
    </style>
</head>
<body class="stage-1">

    <div class="game-container">
        <h1>SYSTEM RECOVERY</h1>
        <p id="game-intro">시스템에 치명적인 오류가 발생했습니다. 3개의 스테이지를 클리어하여 시스템을 복구하고 탈출하세요.</p>

        <!-- Stage 1 -->
        <div id="stage-1" class="stage active">
            <h2>STAGE 1: 기초 논리와 알고리즘</h2>
            <p class="stage-theme">테마: 컴퓨터의 가장 기본적인 사고방식인 '논리'와 '순서'를 배우는 단계입니다.</p>
            
            <div id="puzzle-1-1" class="puzzle">
                <p class="puzzle-title">1-1. 이진법 퍼즐</p>
                <p class="puzzle-content">'ON'이라는 단어를 이진수 코드로 변환하여 합친 값을 입력하세요.<br>(O=01001111, N=01001110)</p>
                <input type="text" id="answer-1-1">
                <button onclick="checkAnswer('1-1', '0100111101001110')">입력</button>
                <p id="message-1-1" class="message"></p>
            </div>

            <div id="puzzle-1-2" class="puzzle" style="display:none;">
                <p class="puzzle-title">1-2. 알고리즘 블록</p>
                <p class="puzzle-content">로봇이 열쇠까지 도달하기 위한 경로를 명령어(F, L, R)로 조합해야 합니다.<br>(힌트: 2칸 앞으로, 오른쪽으로, 2칸 앞으로, 왼쪽으로)</p>
                <input type="text" id="answer-1-2">
                <button onclick="checkAnswer('1-2', 'FFRFFL')">입력</button>
                <p id="message-1-2" class="message"></p>
            </div>

            <div id="puzzle-1-3" class="puzzle" style="display:none;">
                <p class="puzzle-title">1-3. 패턴 추리 (최종 암호의 첫 번째 조각)</p>
                <p class="puzzle-content">1, 3, 5, 7, ? 수열의 규칙을 찾아 다음 숫자를 맞춰야 합니다.</p>
                <input type="text" id="answer-1-3">
                <button onclick="checkAnswer('1-3', '9')">입력</button>
                <p id="message-1-3" class="message"></p>
            </div>
        </div>

        <!-- Stage 2 -->
        <div id="stage-2" class="stage">
            <h2>STAGE 2: 코드 해독과 디버깅</h2>
            <p class="stage-theme">테마: 간단한 프로그래밍 코드를 읽고, 그 안의 오류를 찾아내는 '디버깅' 개념을 익히는 단계입니다.</p>

            <div id="puzzle-2-1" class="puzzle">
                <p class="puzzle-title">2-1. 변수는 상자다 (최종 암호의 두 번째 조각)</p>
                <p class="puzzle-content">A = 10, B = 5일 때, Password = A + B의 값을 계산해야 합니다.</p>
                <input type="text" id="answer-2-1">
                <button onclick="checkAnswer('2-1', '15')">입력</button>
                <p id="message-2-1" class="message"></p>
            </div>

            <div id="puzzle-2-2" class="puzzle" style="display:none;">
                <p class="puzzle-title">2-2. 조건문</p>
                <p class="puzzle-content">if (color == '????') 코드를 보고, 문을 열기 위한 색깔을 맞춰야 합니다. (힌트: 파란색)</p>
                <input type="text" id="answer-2-2">
                <button onclick="checkAnswer('2-2', 'blue')">입력</button>
                <p id="message-2-2" class="message"></p>
            </div>

            <div id="puzzle-2-3" class="puzzle" style="display:none;">
                <p class="puzzle-title">2-3. 디버깅 (최종 암호의 세 번째 조각)</p>
                <p class="puzzle-content">print("Hello World) 코드에서 문법적으로 빠진 기호 한 개를 찾아 입력해야 합니다.</p>
                <input type="text" id="answer-2-3">
                <button onclick="checkAnswer('2-3', '&quot;')">입력</button>
                <p id="message-2-3" class="message"></p>
            </div>
        </div>

        <!-- Stage 3 -->
        <div id="stage-3" class="stage">
            <h2>STAGE 3: 최종 시스템 실행</h2>
            <p class="stage-theme">테마: 지금까지 모은 모든 단서를 종합하여 마지막 시스템을 복구하고 탈출하는 최종 단계입니다.</p>
            
            <div id="clue-box">
                획득한 최종 암호 조각: <span id="clue-1">?</span> <span id="clue-2">?</span> <span id="clue-3">?</span>
            </div>

            <div id="puzzle-3-1" class="puzzle">
                <p class="puzzle-title">3-1. 최종 시스템 실행</p>
                <p class="puzzle-content">지금까지 얻은 '최종 암호 조각'들을 순서대로 조합하여 입력해야 합니다.</p>
                <input type="text" id="answer-3-1">
                <button onclick="checkAnswer('3-1', '915&quot;')">입력</button>
                <p id="message-3-1" class="message"></p>
            </div>
        </div>

        <!-- Game Clear Screen -->
        <div id="game-clear" class="stage">
            <h1>SYSTEM RECOVERY COMPLETE!</h1>
            <p class="success" style="font-size: 1.5em;">축하합니다! 모든 시스템을 복구하고 탈출에 성공했습니다!</p>
        </div>

    </div>

    <script>
        const clues = {
            '1-3': null,
            '2-1': null,
            '2-3': null,
        };

        function checkAnswer(puzzleId, correctAnswer) {
            const userAnswer = document.getElementById(`answer-${puzzleId}`).value.trim();
            const messageEl = document.getElementById(`message-${puzzleId}`);

            // 쌍따옴표 퍼즐 대응: 다양한 입력을 모두 정답으로 인식
            let answerToCheck = correctAnswer;
            if (
                correctAnswer === '\"' ||
                correctAnswer === '"' ||
                correctAnswer === '&quot;' ||
                correctAnswer === '&#34;' ||
                correctAnswer === '&#x22;'
            ) {
                answerToCheck = '"';
            }

            // 사용자 입력도 동일하게 변환
            let userToCheck = userAnswer;
            if (
                userAnswer === '\"' ||
                userAnswer === '"' ||
                userAnswer === '&quot;' ||
                userAnswer === '&#34;' ||
                userAnswer === '&#x22;'
            ) {
                userToCheck = '"';
            }

            // 정답을 대소문자 구분 없이 체크 (예: FFRFFL, ffrffl 모두 정답 처리)
            if (String(userToCheck).toLowerCase() === String(answerToCheck).toLowerCase()) {
                messageEl.textContent = 'ACCESS GRANTED: 정답입니다.';
                messageEl.className = 'message success';
                document.getElementById(`answer-${puzzleId}`).disabled = true;
                document.querySelector(`#puzzle-${puzzleId} button`).disabled = true;

                // 다음 퍼즐 또는 스테이지로 진행
                setTimeout(() => {
                    proceedToNext(puzzleId, answerToCheck);
                }, 1000);
            } else {
                messageEl.textContent = 'ACCESS DENIED: 오답입니다. 다시 시도하세요.';
                messageEl.className = 'message error';
            }
        }

        function proceedToNext(clearedPuzzleId, answer) {
            // 암호 조각 저장
            if (clues.hasOwnProperty(clearedPuzzleId)) {
                clues[clearedPuzzleId] = answer;
                updateClueBox();
            }

            // 다음 퍼즐 표시 로직
            const nextPuzzleMap = {
                '1-1': '1-2', '1-2': '1-3',
                '2-1': '2-2', '2-2': '2-3',
            };

            if (nextPuzzleMap[clearedPuzzleId]) {
                const nextPuzzleId = `puzzle-${nextPuzzleMap[clearedPuzzleId]}`;
                document.getElementById(nextPuzzleId).style.display = 'block';
            }

            // 스테이지 전환 로직 및 배경 변경
            const body = document.body;
            body.classList.remove('stage-1', 'stage-2', 'stage-3');
            if (clearedPuzzleId === '1-3') {
                document.getElementById('stage-1').classList.remove('active');
                document.getElementById('stage-2').classList.add('active');
                body.classList.add('stage-2');
            } else if (clearedPuzzleId === '2-3') {
                document.getElementById('stage-2').classList.remove('active');
                document.getElementById('stage-3').classList.add('active');
                body.classList.add('stage-3');
            } else if (clearedPuzzleId === '3-1') {
                document.getElementById('stage-3').classList.remove('active');
                document.getElementById('game-clear').classList.add('active');
                body.style.backgroundImage = 'none';
            }
        }

        function updateClueBox() {
            document.getElementById('clue-1').textContent = clues['1-3'] || '?';
            document.getElementById('clue-2').textContent = clues['2-1'] || '?';
            document.getElementById('clue-3').textContent = clues['2-3'] || '?';
        }
    </script>

</body>
</html>