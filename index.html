<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì½”ë”© ë°©íƒˆì¶œ: ë²„ê·¸ë¥¼ ì¡ì•„ë¼!</title>
    <style>
        /* --- ê¸°ë³¸ ë° ë ˆì´ì•„ì›ƒ ìŠ¤íƒ€ì¼ --- */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&family=Orbitron:wght@700&display=swap');

        body {
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0;
            background-color: #1a1a1a;
            color: #e0e0e0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        #game-container {
            width: 1000px;
            height: 700px;
            border: 2px solid #444;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
            background-color: #000;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        /* --- í—¤ë” UI --- */
        #header-ui {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background-color: rgba(0, 0, 0, 0.7);
            border-bottom: 1px solid #0ff;
            font-family: 'Orbitron', sans-serif;
        }

        #stage-display, #timer {
            font-size: 24px;
            color: #0ff;
            text-shadow: 0 0 5px #0ff;
        }

        #password-progress { display: flex; gap: 10px; }

        .password-icon {
            width: 30px; height: 30px; border: 2px solid #555; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-size: 20px; color: #555; transition: all 0.3s ease;
        }
        .password-icon.solved {
            border-color: #0ff; color: #0ff; background-color: rgba(0, 255, 255, 0.2);
            box-shadow: 0 0 10px #0ff;
        }

        /* --- ë©”ì¸ ê²Œì„ ì˜ì—­ --- */
        #stage-area {
            flex-grow: 1; position: relative; background-size: cover;
            background-position: center; transition: background-image 1s ease-in-out;
        }

        .clue-box {
            position: absolute; border: 3px dashed yellow; box-shadow: 0 0 15px yellow;
            cursor: pointer; transition: all 0.2s ease;
        }
        .clue-box:hover { background-color: rgba(255, 255, 0, 0.2); }
        .clue-box.solved { display: none; }

        /* --- íŒíŠ¸ ê³ ì–‘ì´ --- */
        #hint-cat-container {
            position: absolute; bottom: 10px; right: 10px;
            cursor: pointer; text-align: center;
        }
        #cat-emoji { font-size: 80px; transition: transform 0.2s; line-height: 1; }
        #hint-cat-container:hover #cat-emoji { transform: scale(1.1); }
        #speech-bubble {
            position: absolute; bottom: 90px; right: 0;
            background-color: rgba(255, 255, 255, 0.9); color: #333;
            padding: 15px; border-radius: 10px; width: 250px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5); opacity: 0;
            visibility: hidden; transition: all 0.3s; font-size: 14px;
        }
        #speech-bubble.show { opacity: 1; visibility: visible; }
        #speech-bubble::after {
            content: ''; position: absolute; bottom: -10px; right: 30px;
            border-width: 10px; border-style: solid;
            border-color: rgba(255, 255, 255, 0.9) transparent transparent transparent;
        }

        /* --- ëª¨ë‹¬ (íŒì—…ì°½) ìŠ¤íƒ€ì¼ --- */
        .modal-backdrop {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.8); display: flex;
            justify-content: center; align-items: center; z-index: 100;
        }

        .modal-content {
            position: relative; /* ë‹«ê¸° ë²„íŠ¼ ìœ„ì¹˜ì˜ ê¸°ì¤€ì  */
            background: #222; padding: 30px; border-radius: 10px;
            border: 1px solid #0ff; text-align: center;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }
        
        .modal-content h2 { margin-top: 0; color: #0ff; }

        .modal-content input {
            padding: 10px; font-size: 18px; width: 250px; margin: 10px 0;
            background: #111; border: 1px solid #555; color: #eee; text-align: center;
        }

        .modal-content button {
            padding: 10px 20px; font-size: 16px; cursor: pointer;
            background-color: #0ff; border: none; color: #000;
            font-weight: bold; border-radius: 5px; margin-top: 10px;
        }
        
        /* [ìƒˆë¡œ ì¶”ê°€] ë‹«ê¸°(X) ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .close-modal-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 28px;
            color: #888;
            cursor: pointer;
            transition: color 0.2s;
            padding: 0;
            margin: 0;
            line-height: 1;
        }
        .close-modal-btn:hover {
            color: #fff;
        }
        
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="game-container">
        <!-- ì‹œì‘/ì¢…ë£Œ í™”ë©´ë“¤ -->
        <div id="start-screen" class="modal-backdrop">
            <div class="modal-content">
                <h1>ì½”ë”© ë°©íƒˆì¶œ</h1>
                <p>"ë²„ê·¸ë¥¼ ì¡ì•„ë¼! ì „ì„¤ì˜ ê°œë°œìë¥¼ ì°¾ì•„ì„œ"</p>
                <p>ì œí•œ ì‹œê°„ì€ 15ë¶„! ëª¨ë“  ë¬¸ì œë¥¼ í•´ê²°í•˜ê³  íƒˆì¶œí•˜ì„¸ìš”.</p>
                <button id="start-button">ê²Œì„ ì‹œì‘</button>
            </div>
        </div>
        <div id="game-over-screen" class="modal-backdrop hidden">
            <div class="modal-content">
                <h1>TIME OVER</h1>
                <p>ì•„ì‰½ì§€ë§Œ, ì‹œìŠ¤í…œ ë³µêµ¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>
                <button onclick="location.reload()">ë‹¤ì‹œ ì‹œì‘</button>
            </div>
        </div>
        <div id="success-screen" class="modal-backdrop hidden">
            <div class="modal-content">
                <h1>íƒˆì¶œ ì„±ê³µ!</h1>
                <p>ì‹œìŠ¤í…œ ë³µêµ¬ ì™„ë£Œ! í™˜ì˜í•©ë‹ˆë‹¤, ìƒˆë¡œìš´ ë™ë£Œ!</p>
                <p id="final-time"></p>
                <button onclick="location.reload()">ë‹¤ì‹œ ì‹œì‘</button>
            </div>
        </div>

        <!-- ë©”ì¸ ê²Œì„ UI -->
        <div id="main-game" class="hidden">
            <div id="header-ui">
                <div id="stage-display">STAGE 1/3</div>
                <div id="password-progress">
                    <div class="password-icon">?</div>
                    <div class="password-icon">?</div>
                    <div class="password-icon">?</div>
                </div>
                <div id="timer">15:00</div>
            </div>
            <div id="stage-area"></div>
            <div id="hint-cat-container">
                <div id="speech-bubble">ê³ ì–‘ì´ë¥¼ í´ë¦­í•˜ë©´ íŒíŠ¸ë¥¼ ì¤„ê²Œì˜¹.</div>
                <div id="cat-emoji">ğŸ˜¸</div>
            </div>
        </div>

        <!-- í¼ì¦ ëª¨ë‹¬ë“¤ (ë‹«ê¸° ë²„íŠ¼ ì¶”ê°€ ì™„ë£Œ) -->
        <div id="puzzle-modal-container" class="hidden">
            <div id="puzzle1-1" class="modal-backdrop hidden">
                <div class="modal-content">
                    <button class="close-modal-btn" onclick="closeCurrentModal()">âœ–</button>
                    <h2>ì´ì§„ë²• í¼ì¦</h2>
                    <p>ëª¨ë‹ˆí„°ì— 'ON'ì´ë¼ëŠ” ê¸€ìê°€ ë³´ì¸ë‹¤.<br>O=01001111, N=01001110<br>ë‘ ì½”ë“œë¥¼ í•©ì³ì„œ ì…ë ¥í•˜ë¼.</p>
                    <input type="text" id="answer1-1" placeholder="ì •ë‹µ ì…ë ¥">
                    <button onclick="checkAnswer(1, 1)">ì…ë ¥</button>
                </div>
            </div>
            <div id="puzzle1-2" class="modal-backdrop hidden">
                <div class="modal-content">
                    <button class="close-modal-btn" onclick="closeCurrentModal()">âœ–</button>
                    <h2>ì•Œê³ ë¦¬ì¦˜ ë¸”ë¡</h2>
                    <p>ë¡œë´‡ì´ ì—´ì‡ ì— ë„ë‹¬í•˜ê¸° ìœ„í•œ ê²½ë¡œëŠ”?<br>ì•: F, ì¢Œ: L, ìš°: R<br>ì˜ˆì‹œ: FFRFFL (ì•-ì•-ì˜¤-ì•-ì•-ì™¼)</p>
                    <input type="text" id="answer1-2" placeholder="ì •ë‹µ ì…ë ¥ (ëŒ€ë¬¸ì)">
                    <button onclick="checkAnswer(1, 2)">ì…ë ¥</button>
                </div>
            </div>
            <div id="puzzle1-3" class="modal-backdrop hidden">
                <div class="modal-content">
                    <button class="close-modal-btn" onclick="closeCurrentModal()">âœ–</button>
                    <h2>íŒ¨í„´ ì¶”ë¦¬</h2>
                    <p>ë‹¤ìŒ ìˆ«ìëŠ” ë¬´ì—‡ì¼ê¹Œ?<br>1, 3, 5, 7, ?</p>
                    <input type="text" id="answer1-3" placeholder="ì •ë‹µ ì…ë ¥">
                    <button onclick="checkAnswer(1, 3)">ì…ë ¥</button>
                </div>
            </div>
            <div id="puzzle2-1" class="modal-backdrop hidden">
                <div class="modal-content">
                    <button class="close-modal-btn" onclick="closeCurrentModal()">âœ–</button>
                    <h2>ë³€ìˆ˜ëŠ” ìƒìë‹¤</h2>
                    <p>A = 10, B = 5<br>Password = A + B<br>Passwordì˜ ê°’ì€?</p>
                    <input type="text" id="answer2-1" placeholder="ì •ë‹µ ì…ë ¥">
                    <button onclick="checkAnswer(2, 1)">ì…ë ¥</button>
                </div>
            </div>
            <div id="puzzle2-2" class="modal-backdrop hidden">
                <div class="modal-content">
                    <button class="close-modal-btn" onclick="closeCurrentModal()">âœ–</button>
                    <h2>ì¡°ê±´ë¬¸</h2>
                    <p>if (color == '????') { open door; }<br>ë¬¸ì„ ì—´ê¸° ìœ„í•œ ìƒ‰ê¹”ì€?</p>
                    <input type="text" id="answer2-2" placeholder="ì •ë‹µ ì…ë ¥ (ì˜ì–´ ì†Œë¬¸ì)">
                    <button onclick="checkAnswer(2, 2)">ì…ë ¥</button>
                </div>
            </div>
            <div id="puzzle2-3" class="modal-backdrop hidden">
                <div class="modal-content">
                    <button class="close-modal-btn" onclick="closeCurrentModal()">âœ–</button>
                    <h2>ë””ë²„ê¹…</h2>
                    <p>print("Hello World)<br>ìœ„ ì½”ë“œì—ì„œ ë¹ ì§„ ê¸°í˜¸ëŠ”?</p>
                    <input type="text" id="answer2-3" placeholder="ì •ë‹µ ì…ë ¥">
                    <button onclick="checkAnswer(2, 3)">ì…ë ¥</button>
                </div>
            </div>
            <div id="puzzle3-1" class="modal-backdrop hidden">
                <div class="modal-content">
                    <button class="close-modal-btn" onclick="closeCurrentModal()">âœ–</button>
                    <h2>ìµœì¢… ì‹œìŠ¤í…œ ì‹¤í–‰</h2>
                    <p>ì§€ê¸ˆê¹Œì§€ ì–»ì€ ë‹¨ì„œë“¤ì„ ì¡°í•©í•˜ì—¬<br>ìµœì¢… ì•”í˜¸ë¥¼ ì…ë ¥í•˜ë¼.</p>
                    <input type="text" id="answer3-1" placeholder="ìµœì¢… ì•”í˜¸ ì…ë ¥">
                    <button onclick="checkAnswer(3, 1)">ì‹œìŠ¤í…œ ë³µêµ¬</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- DOM ìš”ì†Œ ê°€ì ¸ì˜¤ê¸° ---
        const mainGame = document.getElementById('main-game');
        const startButton = document.getElementById('start-button');
        const stageDisplay = document.getElementById('stage-display');
        const timerDisplay = document.getElementById('timer');
        const passwordIcons = document.querySelectorAll('.password-icon');
        const stageArea = document.getElementById('stage-area');
        const hintCat = document.getElementById('hint-cat-container');
        const speechBubble = document.getElementById('speech-bubble');
        const puzzleModalContainer = document.getElementById('puzzle-modal-container');

        // --- ê²Œì„ ìƒíƒœ ë³€ìˆ˜ ---
        let currentStage = 1;
        let timeLeft = 900;
        let timerInterval;
        let passwordParts = ['?', '?', '?'];
        let solvedClues = [];

        // --- ê²Œì„ ë°ì´í„° ---
        const gameData = {
            1: {
                background: '1-1.jpg',
                clues: [
                    { id: '1-1', top: '25%', left: '10%', width: '150px', height: '150px' },
                    { id: '1-2', top: '60%', left: '30%', width: '200px', height: '150px' },
                    { id: '1-3', top: '30%', left: '70%', width: '180px', height: '100px' }
                ],
                answers: { '1-1': '0100111101001110', '1-2': 'FFRFFL', '1-3': '9' },
                hint: '1ë‹¨ê³„ëŠ” ì»´í“¨í„°ì˜ ê¸°ë³¸ì— ëŒ€í•œ ê±°ì•¼. ì´ì§„ë²•, ìˆœì„œë„, ê·¸ë¦¬ê³  ê·œì¹™ ì°¾ê¸°! ì£¼ë³€ì„ ì˜ ì‚´í´ë´.'
            },
            2: {
                background: '2-1.jpg',
                clues: [
                    { id: '2-1', top: '50%', left: '5%', width: '180px', height: '180px' },
                    { id: '2-2', top: '20%', left: '40%', width: '120px', height: '200px' },
                    { id: '2-3', top: '60%', left: '75%', width: '200px', height: '120px' }
                ],
                answers: { '2-1': '15', '2-2': 'blue', '2-3': '"' },
                hint: 'ì½”ë“œëŠ” ì•½ì†ì´ì•¼. ë³€ìˆ˜ì— ê°’ì„ ë„£ê³ , ì¡°ê±´ì— ë”°ë¼ í–‰ë™í•˜ê³ , ë¬¸ë²•ì„ ì •í™•íˆ ì§€ì¼œì•¼ í•´. ì˜¤íƒ€ëŠ” ì—†ëŠ”ì§€ ì˜ ë´!'
            },
            3: {
                background: '3-2.jpg',
                clues: [
                    { id: '3-1', top: '40%', left: '35%', width: '250px', height: '150px' }
                ],
                answers: { '3-1': '915"' },
                hint: 'ì§€ê¸ˆê¹Œì§€ ëª¨ì€ ë‹¨ì„œë“¤ì„ ìˆœì„œëŒ€ë¡œ í•©ì³ë´. 1ë‹¨ê³„ íŒ¨í„´ì˜ ë‹µ, 2ë‹¨ê³„ ë¹„ë°€ë²ˆí˜¸ì˜ ê°’, ê·¸ë¦¬ê³  2ë‹¨ê³„ ë””ë²„ê¹…ì˜ ë‹µì´ì•¼.'
            }
        };

        // --- ê²Œì„ ë¡œì§ í•¨ìˆ˜ ---
        function startGame() {
            document.getElementById('start-screen').classList.add('hidden');
            mainGame.classList.remove('hidden');
            timerInterval = setInterval(updateTimer, 1000);
            loadStage(1);
        }

        function updateTimer() {
            timeLeft--;
            const minutes = Math.floor(timeLeft / 60).toString().padStart(2, '0');
            const seconds = (timeLeft % 60).toString().padStart(2, '0');
            timerDisplay.textContent = `${minutes}:${seconds}`;
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                endGame(false);
            }
        }

        function loadStage(stageNum) {
            currentStage = stageNum;
            const stage = gameData[stageNum];
            stageDisplay.textContent = `STAGE ${stageNum}/3`;
            stageArea.style.backgroundImage = `url(./${stage.background})`;
            stageArea.innerHTML = '';
            stage.clues.forEach(clueData => {
                if (solvedClues.includes(clueData.id)) return;
                const clueEl = document.createElement('div');
                clueEl.className = 'clue-box';
                clueEl.id = `clue-${clueData.id}`;
                clueEl.style.top = clueData.top;
                clueEl.style.left = clueData.left;
                clueEl.style.width = clueData.width;
                clueEl.style.height = clueData.height;
                clueEl.onclick = () => openPuzzleModal(clueData.id);
                stageArea.appendChild(clueEl);
            });
        }

        function openPuzzleModal(puzzleId) {
            document.querySelectorAll('#puzzle-modal-container > div').forEach(modal => {
                modal.classList.add('hidden');
            });
            const targetModal = document.getElementById(`puzzle${puzzleId}`);
            if (targetModal) {
                targetModal.classList.remove('hidden');
                puzzleModalContainer.classList.remove('hidden');
            }
        }

        // [ìƒˆë¡œ ì¶”ê°€] í˜„ì¬ ì—´ë¦° ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
        function closeCurrentModal() {
            puzzleModalContainer.classList.add('hidden');
        }

        function checkAnswer(stageNum, puzzleNum) {
            const puzzleId = `${stageNum}-${puzzleNum}`;
            const answer = document.getElementById(`answer${puzzleId}`).value.trim();
            const correctAnswer = gameData[stageNum].answers[puzzleId];

            if (answer === correctAnswer) {
                alert('ì •ë‹µì…ë‹ˆë‹¤!');
                const clueEl = document.getElementById(`clue-${puzzleId}`);
                if(clueEl) clueEl.classList.add('solved');
                solvedClues.push(puzzleId);

                if (stageNum === 1) passwordParts[0] = gameData[1].answers['1-3'];
                else if (stageNum === 2) {
                    passwordParts[1] = gameData[2].answers['2-1'];
                    passwordParts[2] = gameData[2].answers['2-3'];
                }
                updatePasswordDisplay();
                closeCurrentModal(); // ì •ë‹µ ë§ì¶°ë„ ì°½ ë‹«ê¸°
                
                const stageClues = gameData[stageNum].clues.map(c => c.id);
                const isStageClear = stageClues.every(id => solvedClues.includes(id));

                if (isStageClear) {
                    if (currentStage < 3) {
                        alert(`ìŠ¤í…Œì´ì§€ ${currentStage} í´ë¦¬ì–´! ë‹¤ìŒ ìŠ¤í…Œì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.`);
                        loadStage(currentStage + 1);
                    } else {
                        endGame(true);
                    }
                }
            } else {
                alert('í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ìƒê°í•´ë³´ì„¸ìš”.');
            }
        }

        function updatePasswordDisplay() {
            passwordParts.forEach((part, index) => {
                if (part !== '?') {
                    passwordIcons[index].textContent = 'âœ“';
                    passwordIcons[index].classList.add('solved');
                }
            });
        }

        function showHint() {
            speechBubble.textContent = gameData[currentStage].hint;
            speechBubble.classList.add('show');
            setTimeout(() => { speechBubble.classList.remove('show'); }, 4000);
        }

        function endGame(isSuccess) {
            clearInterval(timerInterval);
            mainGame.classList.add('hidden');
            if (isSuccess) {
                const timeTaken = 900 - timeLeft;
                const minutes = Math.floor(timeTaken / 60);
                const seconds = timeTaken % 60;
                document.getElementById('final-time').textContent = `í´ë¦¬ì–´ ì‹œê°„: ${minutes}ë¶„ ${seconds}ì´ˆ`;
                document.getElementById('success-screen').classList.remove('hidden');
            } else {
                document.getElementById('game-over-screen').classList.remove('hidden');
            }
        }

        // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
        startButton.addEventListener('click', startGame);
        hintCat.addEventListener('click', showHint);
    </script>
</body>
</html>